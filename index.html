<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KREBS ADVENTURE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #050a10;
            --panel-bg: rgba(16, 26, 35, 0.85);
            --border-color: rgba(66, 219, 255, 0.3);
            --accent-blue: #00f3ff;
            --accent-red: #ff2a6d;
            --accent-green: #05ffa1;
            --accent-yellow: #ffc800;
            --text-main: #e0f7fa;
            --text-muted: #8aa1a8;
        }

        * {
            box-sizing: border-box;
            user-select: none; /* Prevents text selection on double tap */
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 50% 50%, #112233 0%, #050a10 100%);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- Main Game Container --- */
        #game-container {
            width: 100%;
            max-width: 1000px;
            height: 100%;
            max-height: 800px;
            background: rgba(12, 20, 30, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 50px rgba(0, 243, 255, 0.1);
        }

        /* Mobile full screen override */
        @media (max-width: 768px) {
            #game-container {
                border-radius: 0;
                border: none;
                max-height: 100vh;
            }
        }

        /* --- Start Screen --- */
        #start-screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5, 10, 16, 0.98);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
        }

        #start-screen h1 {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent-blue);
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
        }

        #start-screen p {
            font-size: 1.2rem;
            max-width: 500px;
            color: var(--text-muted);
            margin-bottom: 2rem;
        }

        /* --- Status Bar --- */
        #status-bar {
            background: var(--panel-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .stat-badge {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            justify-content: center;
            white-space: nowrap;
        }

        .stat-value { color: var(--accent-yellow); }
        .stat-co2 .stat-value { color: var(--accent-red); }

        /* --- Scene Area (Visuals) --- */
        #scene-area {
            flex-grow: 1;
            position: relative;
            background-image: url('matrix_bg.png'); /* Ensure this matches your file */
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: space-around;
            align-items: center;
            overflow: hidden;
        }

        /* Overlay gradient to make text readable */
        #scene-area::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(circle, rgba(0,0,0,0.2) 0%, rgba(5,10,16,0.8) 100%);
            z-index: 1;
        }

        #location-label {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 8px 24px;
            border-radius: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            letter-spacing: 2px;
            text-transform: uppercase;
            z-index: 10;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }

        #feedback-msg {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            z-index: 20;
            display: none;
            backdrop-filter: blur(4px);
            text-align: center;
            width: 90%;
            max-width: 400px;
        }
        .wrong-msg { 
            background: rgba(255, 42, 109, 0.2); 
            border: 1px solid var(--accent-red); 
            color: #ff8fa3; 
        }
        .correct-msg { 
            background: rgba(5, 255, 161, 0.2); 
            border: 1px solid var(--accent-green); 
            color: var(--accent-green); 
        }

        /* --- Sprites --- */
        .sprite {
            width: 180px;
            height: 180px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: relative;
            z-index: 5;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* Add floating animation */
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        #player-sprite { filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.4)); }
        #enemy-sprite { filter: drop-shadow(0 0 15px rgba(255, 42, 109, 0.4)); animation-delay: 1.5s; }

        .molecule-label-container {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.9rem;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .carbon-count {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--text-main);
            color: #000;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 800;
            border: 2px solid var(--accent-blue);
            box-shadow: 0 0 10px var(--accent-blue);
        }

        /* --- UI / Control Panel --- */
        #ui-container {
            height: 40%;
            min-height: 250px;
            background: var(--panel-bg);
            border-top: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 15px;
            z-index: 20;
        }

        /* Tablet/Desktop Layout: Side by Side */
        @media (min-width: 768px) {
            #ui-container {
                flex-direction: row;
                height: 220px;
                min-height: auto;
            }
            #dialogue-box { width: 60%; border-right: 1px solid rgba(255,255,255,0.1); padding-right: 20px; }
            #controls-box { width: 40%; }
        }

        #dialogue-box {
            font-size: 1.1rem;
            line-height: 1.5;
            color: var(--text-main);
            overflow-y: auto;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--accent-blue);
        }

        #controls-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
            flex-grow: 1;
        }

        /* --- Buttons --- */
        button {
            font-family: 'Orbitron', sans-serif;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .option-btn {
            padding: 15px;
            font-size: 0.9rem;
            background: rgba(0, 243, 255, 0.1);
            color: var(--accent-blue);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: 6px;
            text-align: left;
            display: flex;
            align-items: center;
        }
        
        .option-btn::before {
            content: '>';
            margin-right: 10px;
            opacity: 0.5;
        }

        .option-btn:hover:not(:disabled) {
            background: rgba(0, 243, 255, 0.2);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
            transform: translateX(5px);
        }
        
        .option-btn:disabled {
            opacity: 0.5;
            cursor: default;
            filter: grayscale(1);
        }

        #continue-btn, #restart-btn, .start-btn {
            padding: 18px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 6px;
            width: 100%;
            text-align: center;
        }

        .start-btn {
            background: var(--accent-blue);
            color: #000;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
            max-width: 300px;
        }
        
        #continue-btn {
            background: var(--accent-green);
            color: #000;
            display: none;
            box-shadow: 0 0 20px rgba(5, 255, 161, 0.3);
        }
        
        #restart-btn {
            background: var(--accent-yellow);
            color: #000;
            display: none;
        }

        /* --- Animations & Effects --- */
        .battle-flash { animation: flash 0.3s ease-out; }
        @keyframes flash {
            0% { filter: brightness(1); }
            50% { filter: brightness(2) contrast(1.5); }
            100% { filter: brightness(1); }
        }

        .shake-effect { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .reward-popup {
            position: absolute;
            color: var(--accent-yellow);
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            font-size: 1.8em;
            pointer-events: none;
            z-index: 50;
            animation: floatUp 1.2s forwards;
            text-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { transform: translateY(-20px) scale(1.2); opacity: 1; }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }

        /* Mobile Optimization */
        @media (max-width: 600px) {
            .sprite { width: 120px; height: 120px; }
            #start-screen h1 { font-size: 2rem; }
            .option-btn { padding: 12px; font-size: 0.85rem; }
            .stat-badge { font-size: 0.8rem; padding: 4px; }
            #dialogue-box { font-size: 0.95rem; }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="start-screen">
            <h1>KREBS ADVENTURE</h1>
            <p>
                Enter the Mitochondrial Matrix.<br>
                Complete the cycle. Power the cell.
            </p>
            <button class="start-btn" onclick="startGame()">INITIALIZE</button>
        </div>

        <div id="status-bar">
            <div class="stat-badge">NADH: <span class="stat-value" id="nadh-count">0</span></div>
            <div class="stat-badge">FADH₂: <span class="stat-value" id="fadh-count">0</span></div>
            <div class="stat-badge">ATP: <span class="stat-value" id="atp-count">0</span></div>
            <div class="stat-badge stat-co2">CO₂: <span class="stat-value" id="co2-count">0</span></div>
        </div>

        <div id="scene-area">
            <div id="location-label">Matrix Core</div>
            <div id="feedback-msg"></div>
            
            <div id="player-sprite" class="sprite">
                <div class="carbon-count" id="player-carbons">2C</div>
                <div class="molecule-label-container">
                    <div id="player-name">Acetyl CoA</div>
                </div>
            </div>

            <div id="enemy-sprite" class="sprite" style="opacity: 0;">
                <div class="molecule-label-container">
                    <div id="enemy-name">Target</div>
                </div>
            </div>
        </div>

        <div id="ui-container">
            <div id="dialogue-box">System Initializing... waiting for user input.</div>
            <div id="controls-box">
                <div id="options-container" style="display: flex; flex-direction: column; gap: 8px;"></div>
                <button id="continue-btn" onclick="nextStage()">PROCEED TO NEXT PHASE</button>
                <button id="restart-btn" onclick="location.reload()">REBOOT SYSTEM</button>
            </div>
        </div>
    </div>

<script>
    let gameState = {
        stageIndex: -1,
        nadh: 0, fadh2: 0, atp: 0, co2: 0,
        currentPlayer: "Acetyl CoA",
        currentCarbons: 2,
        currentImage: "acetylcoa.png"
    };

    const stages = [
        // SCENE 1
        {
            loc: "The City of ATE",
            text: "You carry 2 carbons from Glycolysis. Choose the correct process to combine with 4-carbon Oxaloacetate to form 6-carbon Citrate.",
            enemy: "Oxaloacetate", enemyImg: "oxaloacetate.png",
            options: [
                { text: "Condensation", correct: true },
                { text: "Oxidation", correct: false },
                { text: "Phosphorylation", correct: false }
            ],
            type: "question"
        },
        // SCENE 2
        {
            loc: "The City of ATE",
            text: "Correct! You are now Citrate. The cycle has officially begun.",
            evo: "Citrate", c: 6, img: "citrate.png",
            type: "success",
            rewards: {}
        },
        // SCENE 3
        {
            loc: "The City of ATE",
            text: "To form Isocitrate, you need to remove one water molecule and add another. Choose the correct process.",
            options: [
                { text: "Isomerisation", correct: true },
                { text: "Hydration", correct: false }
            ],
            type: "question"
        },
        // SCENE 4
        {
            loc: "The City of ATE",
            text: "Congratulations! You have successfully converted into Isocitrate.",
            evo: "Isocitrate", c: 6, img: "isocitrate.png",
            type: "success",
            rewards: {}
        },
        // SCENE 5
        {
            loc: "Oxidative Decarboxylation City",
            text: "NAD+ is here! Rip a carbon off (decarboxylation) and release it as CO2 to harvest high-energy electrons. Choose a skill:",
            enemy: "NAD+", enemyImg: "nad_plus.png",
            options: [
                { text: "Phosphorylation", correct: false },
                { text: "Reduction", correct: false },
                { text: "Oxidation", correct: true }
            ],
            type: "question"
        },
        // SCENE 6
        {
            loc: "Oxidative Decarboxylation City",
            text: "Success! You released CO2 and reduced NAD+.",
            evo: "Alpha-Ketoglutarate", c: 5, img: "alpha_keto.png",
            type: "success",
            rewards: {nadh: 1, co2: 1}
        },
        // SCENE 7
        {
            loc: "Oxidative Decarboxylation City",
            text: "Another NAD+ fight! Release a carbon as CO2. Choose the process to reduce NAD+ to NADH:",
            enemy: "NAD+", enemyImg: "nad_plus.png",
            options: [
                { text: "Oxidative Decarboxylation", correct: true },
                { text: "Hydration", correct: false }
            ],
            type: "question"
        },
        // SCENE 8
        {
            loc: "Oxidative Decarboxylation City",
            text: "Excellent! Coenzyme A is attached. You are now 4-carbon Succinyl-CoA. You released 2 CO2 molecules!",
            evo: "Succinyl-CoA", c: 4, img: "succinyl_coa.png",
            type: "success",
            rewards: {nadh: 1, co2: 1}
        },
        // SCENE 9
        {
            loc: "The GDP Junction",
            text: "The GDP Master has appear. He needs a phosphate group from you to proceed. Choose the correct process.",
            enemy: "GDP Master", enemyImg: "gdp.png",
            options: [
                { text: "Oxidative decarboxylation", correct: false },
                { text: "Substrate-level phosphorylation", correct: true },
                { text: "Oxidative Phosphorylation", correct: false }
            ],
            type: "question"
        },
        // SCENE 10
        {
            loc: "The GDP Junction",
            text: "Phosphate transferred! GDP formed GTP, which formed ATP. You gained 1 ATP.",
            evo: "Succinate", c: 4, img: "succinate.png",
            type: "success",
            rewards: {atp: 1}
        },
        // SCENE 11
        {
            loc: "The City of ATE",
            text: "FAD has appeared! Choose the correct skill to defeat FAD and gain FADH2.",
            enemy: "FAD", enemyImg: "fad.png",
            options: [
                { text: "Donate 2 electrons", correct: false },
                { text: "Donate 2 protons (H+)", correct: false },
                { text: "Donate 2 electrons and 2 protons", correct: true }
            ],
            type: "question"
        },
        // SCENE 12
        {
            loc: "The City of ATE",
            text: "Succinate oxidised into Fumarate! You gained 1 FADH2.",
            evo: "Fumarate", c: 4, img: "fumarate.png",
            type: "success",
            rewards: {fadh2: 1}
        },
        // SCENE 13
        {
            loc: "The City of ATE",
            text: "Prepare for the final step. Hydrate now. Choose the correct process.",
            options: [
                { text: "Add one water molecule", correct: true },
                { text: "Remove water molecule", correct: false }
            ],
            type: "question"
        },
        // SCENE 13b
        {
            loc: "The City of ATE",
            text: "Hydration complete! You have evolved into Malate.",
            evo: "Malate", c: 4, img: "malate.png",
            type: "success",
            rewards: {}
        },
        // SCENE 14
        {
            loc: "The City of ATE",
            text: "Oxidize the final bond to regenerate Oxaloacetate!",
            enemy: "NAD+", enemyImg: "nad_plus.png",
            options: [
                { text: "Release 1 CO2", correct: false },
                { text: "Transfer electron and H+", correct: true }
            ],
            type: "question"
        },
        // SCENE 15
        {
            loc: "The City of ATE",
            text: "Final oxidation complete! You have regenerated Oxaloacetate.",
            evo: "Oxaloacetate", c: 4, img: "oxaloacetate.png",
            type: "success",
            rewards: {nadh: 1}
        }
    ];

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        nextStage();
    }

    function triggerBattleEffect(rewards) {
        if (!rewards || Object.keys(rewards).length === 0) return;
        
        const scene = document.getElementById('scene-area');
        scene.classList.add('battle-flash');
        setTimeout(() => scene.classList.remove('battle-flash'), 300);

        Object.entries(rewards).forEach(([key, val], index) => {
            const popup = document.createElement('div');
            popup.className = 'reward-popup';
            popup.textContent = `+${val} ${key.toUpperCase()}`;
            popup.style.left = '50%';
            popup.style.top = '50%';
            popup.style.transform = 'translate(-50%, -50%)';
            scene.appendChild(popup);
            setTimeout(() => popup.remove(), 1200);
        });
    }
    
    function showFeedback(msg, type) {
        const fbBox = document.getElementById('feedback-msg');
        fbBox.textContent = msg;
        fbBox.className = type === 'error' ? 'wrong-msg' : 'correct-msg';
        fbBox.style.display = 'block';
        
        if(type === 'error') {
            document.getElementById('game-container').classList.add('shake-effect');
            setTimeout(() => document.getElementById('game-container').classList.remove('shake-effect'), 400);
        }
    }

    function handleOptionClick(isCorrect) {
        if (isCorrect) {
            showFeedback("CORRECT SEQUENCE", "success");
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => btn.disabled = true);
            
            setTimeout(() => {
                document.getElementById('feedback-msg').style.display = 'none';
                nextStage();
            }, 1000);
        } else {
            showFeedback("INCORRECT - TRY AGAIN", "error");
        }
    }

    function nextStage() {
        gameState.stageIndex++;
        if (gameState.stageIndex >= stages.length) {
            endGame();
            return;
        }

        const stage = stages[gameState.stageIndex];
        
        // Update UI Text
        document.getElementById('location-label').textContent = stage.loc;
        document.getElementById('dialogue-box').textContent = stage.text;
        
        // Setup Enemy/Helper
        const enemy = document.getElementById('enemy-sprite');
        if (stage.enemy) {
            enemy.style.opacity = 1;
            document.getElementById('enemy-name').textContent = stage.enemy;
            if(stage.enemyImg) enemy.style.backgroundImage = `url('${stage.enemyImg}')`;
        } else {
            enemy.style.opacity = 0;
        }

        // Handle Stage Type
        const optionsContainer = document.getElementById('options-container');
        const continueBtn = document.getElementById('continue-btn');
        optionsContainer.innerHTML = ''; 

        if (stage.type === 'question') {
            continueBtn.style.display = 'none';
            stage.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = opt.text;
                btn.onclick = () => handleOptionClick(opt.correct);
                optionsContainer.appendChild(btn);
            });
        } else if (stage.type === 'success') {
            if(stage.evo) {
                gameState.currentPlayer = stage.evo;
                gameState.currentCarbons = stage.c;
                gameState.currentImage = stage.img;
            }
            
            if(stage.rewards) {
                gameState.nadh += stage.rewards.nadh || 0;
                gameState.fadh2 += stage.rewards.fadh2 || 0;
                gameState.atp += stage.rewards.atp || 0;
                gameState.co2 += stage.rewards.co2 || 0;
                triggerBattleEffect(stage.rewards);
            }
            updateUI();
            continueBtn.style.display = 'block';
        }
        updateUI();
    }

    function updateUI() {
        document.getElementById('nadh-count').textContent = gameState.nadh;
        document.getElementById('fadh-count').textContent = gameState.fadh2;
        document.getElementById('atp-count').textContent = gameState.atp;
        document.getElementById('co2-count').textContent = gameState.co2;
        document.getElementById('player-name').textContent = gameState.currentPlayer;
        document.getElementById('player-carbons').textContent = gameState.currentCarbons + 'C';
        document.getElementById('player-sprite').style.backgroundImage = `url('${gameState.currentImage}')`;
    }

    function endGame() {
        const finalMsg = "CYCLE COMPLETE.\nYield: 3 NADH, 1 FADH₂, 1 ATP, 2 CO₂.\nContribution: ~34 ATP to Electron Transport Chain.";
        document.getElementById('dialogue-box').innerText = finalMsg;
        document.getElementById('options-container').innerHTML = '';
        document.getElementById('continue-btn').style.display = 'none';
        document.getElementById('restart-btn').style.display = 'block';
        document.getElementById('enemy-sprite').style.opacity = 0;
        document.getElementById('location-label').textContent = "System Restoration Complete";
    }
</script>
</body>
</html>